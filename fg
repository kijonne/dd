# Решение практической работы №15: Применение встроенных функций SQL

## 5.1 Округление цен товаров до десятков
```sql
UPDATE Товары
SET Цена = ROUND(Цена, -1);
```

## 5.2 Количество заказов по месяцам и годам
```sql
SELECT 
    YEAR(ДатаЗаказа) AS Год,
    MONTH(ДатаЗаказа) AS Месяц,
    COUNT(*) AS КоличествоЗаказов
FROM Заказы
GROUP BY YEAR(ДатаЗаказа), MONTH(ДатаЗаказа)
ORDER BY Год DESC, Месяц DESC;
```

## 5.3 Уменьшение цены на 10% для товаров, не заказанных в текущем году
```sql
UPDATE Товары
SET Цена = Цена * 0.9
WHERE ID_Товара NOT IN (
    SELECT DISTINCT ID_Товара 
    FROM СоставЗаказа
    WHERE ID_Заказа IN (
        SELECT ID_Заказа 
        FROM Заказы 
        WHERE YEAR(ДатаЗаказа) = YEAR(GETDATE())
    )
);
```

## 5.4 Форматирование информации о заказчиках
```sql
SELECT 
    ID_Заказчика,
    UPPER(Фамилия) + ' ' + UPPER(LEFT(Имя, 1)) + '.' AS ФорматированноеИмя
FROM Заказчики;
```

## 5.5 Очистка и форматирование логинов
```sql
UPDATE Заказчики
SET Логин = REPLACE(LTRIM(RTRIM(Логин)), ' ', '_');
```

## 5.6 Вывод информации о покупателях с обработкой NULL
```sql
SELECT 
    ID_Покупателя,
    Имя,
    Фамилия,
    CASE 
        WHEN Телефон IS NULL THEN '→ (прочерк)'
        ELSE Телефон
    END AS Телефон,
    NULLIF(Адрес, '') AS Адрес
FROM Покупатели;
```

## 5.7 Список книг, сгруппированных по авторам
```sql
SELECT 
    Автор,
    STRING_AGG(Название, ', ') WITHIN GROUP (ORDER BY Название) AS Книги
FROM Книги
GROUP BY Автор;
```

## 5.8 Список авторов и книг, сгруппированных по заказам
```sql
SELECT 
    z.ID_Заказа,
    STRING_AGG(CONCAT(k.Автор, ' - ', k.Название), '; ') WITHIN GROUP (ORDER BY k.Название) AS КнигиВЗаказе
FROM Заказы z
JOIN СоставЗаказа sz ON z.ID_Заказа = sz.ID_Заказа
JOIN Книги k ON sz.ID_Книги = k.ID_Книги
GROUP BY z.ID_Заказа;
```

## 5.9 Пронумерованный список всех книг
```sql
SELECT 
    ROW_NUMBER() OVER (ORDER BY Название) AS Номер,
    Название
FROM Книги;
```

## 5.10 Пронумерованный список книг по жанрам
```sql
SELECT 
    Жанр,
    ROW_NUMBER() OVER (PARTITION BY Жанр ORDER BY Название) AS НомерВЖанре,
    Название
FROM Книги
ORDER BY Жанр, Название;
```

## Ответы на контрольные вопросы

### 8.1 В чем преимущество применения встроенных функций?
Встроенные функции SQL позволяют:
- Упрощать сложные операции обработки данных
- Повышать производительность за счет оптимизации на уровне СУБД
- Обеспечивать единообразие обработки данных
- Уменьшать объем кода в приложениях
- Позволяют выполнять операции, которые сложно или невозможно реализовать в клиентском коде

### 8.2 Какие виды системных функций имеются в MSSQL?
В MS SQL Server существуют следующие основные категории встроенных функций:
1. Математические функции (ROUND, ABS, SQRT и др.)
2. Строковые функции (L
